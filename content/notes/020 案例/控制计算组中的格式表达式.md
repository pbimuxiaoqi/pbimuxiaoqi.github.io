---
created: 2022-06-19
tags: 计算组 字符格式化 
subject: 案例
importance: 4
skilled: 4
status:
author: sqlbi
url:
cover: 
---
[控制字符显示格式](https://www.sqlbi.com/articles/controlling-format-strings-in-calculation-groups/)

![](https://secure2.wostatic.cn/static/nuTosmoC8Fe2dKXRVTBtPu/image.png?auth_key=1655612494-qHAbFhVYBAhmp5JyJewZPC-0-6216855f354b49c67b205bd0a1e5c1f9)

已经知道，在计算组中可以设置表达式的格式

![](https://secure2.wostatic.cn/static/nFJwuiUbYxDCou8vEndNmB/image.png?auth_key=1655612506-2ZuDeLdSLAbTc4v2BwPsdT-0-ee241cdc0741ee150528748a7b741e1e)

这只是一个很简单的应用，如果我们报告中有多种货币格式，那么我们就需要编写更复杂的格式表达式来控制度量值的格式。

![](https://secure2.wostatic.cn/static/jLL9GecWdwkKAzDTK9enNu/image.png?auth_key=1655612514-a5cHm8xEzTnXU2rLMctaAZ-0-45234974c4cdac55dad10ffdca8fde2b)

![](https://secure2.wostatic.cn/static/uWDaZhyCrrsam21rzH5ih5/image.png?auth_key=1655612521-tQoLaagwZmBhHYNWdrALfj-0-c512c5664f5d8c289ce7f31e7771bb48)

来看下计算组的具体实现

-   当前选中的货币格式
-   默认的度量类型
-   货币汇率按月聚和表
-   重新计算度量
-   激活交叉筛选，具体使用可查看CROSSFILTER

```js
CALCULATE (
    VAR SelectedCurrency =
        SELECTEDVALUE ( 'Currency'[Currency Code], "USD" )
    VAR MeasureName = 
        SELECTEDVALUE ( 
            Metric[Metric], 
            SELECTEDMEASURENAME() 
        ) 
    VAR SkipConversion = (SEARCH ( "#", MeasureName, 1, 0 ) > 0) || (SEARCH ( "%", MeasureName, 1, 0 ) > 0)
    RETURN 
        IF (
            SkipConversion || SelectedCurrency = "USD",
            SELECTEDMEASURE (),
            -- Single Currency non-US selected
            VAR DatesExchange =
                ADDCOLUMNS (
                    SUMMARIZE ( ExchangeRate, 'Date'[Calendar Year Month Number] ),
                    "ExchangeAverageRate", CALCULATE ( VALUES ( 'ExchangeRate'[AverageRate] ) )
                )
            VAR Result =
                SUMX ( DatesExchange, SELECTEDMEASURE () * [ExchangeAverageRate] )
            RETURN
                Result
        ),
    CROSSFILTER ( Sales[CurrencyKey], 'Currency'[CurrencyKey], NONE )
) 

```

接下来是格式表达式的设置

```js
VAR MeasureName = SELECTEDMEASURENAME()
VAR SkipConversion = 
    NOT ISCROSSFILTERED ( 'Currency' )
        || (SEARCH ( "#", MeasureName, 1, 0 ) > 0) 
        || (SEARCH ( "%", MeasureName, 1, 0 ) > 0)
VAR CurrencyFormat =
    SELECTEDVALUE ( 'Currency'[Currency Format], "#,0.00" )
VAR Result =
    IF ( 
        SkipConversion, 
        SELECTEDMEASUREFORMATSTRING(), 
        CurrencyFormat 
    )
RETURN 
    Result

```