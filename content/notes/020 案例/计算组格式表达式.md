---
created: 2022-08-22
tags: 计算组 字符格式化 
subject: 计算组
importance: 5
skilled: 5
status:
author:
url: https://www.wolai.com/muxiaoqi/vkRfnTDtTSCyTBCedMe9TM
cover: 
---

```dataview
list 
without id
url
where file.name = this.file.name
```


在昨天的文章中有说到目前版本的PowerBI有Bug会导致使用UNICHAR返回字符时有问题，但是目前在计算组中仍然是正常使用的。

说到计算组，即便是已经有了字段参数的今天，仍要说这是近三年PowerBI最强大的功能。当然，也不是没有缺点，缺点就是两年多过年了，书写计算组仍然要通过外部工具，比如常用的Tabular Editor。

计算组有两个表达式，一个是计算表达式，一个是格式表达式。计算表达式我们应该并不陌生了，它可以做很多事，比如常见的用法有：

-   时间智能，减少度量值数量
-   切换下单日期、发货日期等
-   动态显示最近N个月数据
-   blank替换为0
-   TopN和其他
-   切换显示货币
-   重新计算范围，实现双算

格式表达式也有很多种用法：

-   统一格式化度量值
-   自动切换单位， [[PowerBI自动切换中英文单位]]
-   同时显示值和百分比， [[控制度量值显示格式]]
-   度量值说明， [[使用计算组在工具提示中解释度量值]]

## 统一格式化度量

今天我们主要是介绍格式表达式，在正式介绍之前先来回顾下通常我们是怎么设置度量值格式的，在格式下拉选择度量值的类型或者直接直接输入自定义的格式字符串

![https://img-blog.csdnimg.cn/img_convert/30b37b074efd4acefacdc1e0bd8d099a.png](https://img-blog.csdnimg.cn/img_convert/30b37b074efd4acefacdc1e0bd8d099a.png)

![https://img-blog.csdnimg.cn/img_convert/d2682dd7ce20f0d96bf82fc88162df2d.png](https://img-blog.csdnimg.cn/img_convert/d2682dd7ce20f0d96bf82fc88162df2d.png)

在计算组中没有下拉选项来供我们选择，所以通常是用格式字符串，就像下面这样

![https://img-blog.csdnimg.cn/img_convert/75a9ea06223347d3326eb2d2ac95af75.png](https://img-blog.csdnimg.cn/img_convert/75a9ea06223347d3326eb2d2ac95af75.png)

这样写没有任何问题，在报表中效果如下

![https://img-blog.csdnimg.cn/img_convert/615cad3160983917199d255096eeaab0.png](https://img-blog.csdnimg.cn/img_convert/615cad3160983917199d255096eeaab0.png)

接下来，我们就可以统一来格式化度量值，但是这里有个前提就是度量值命名时我们要区分不同类型的度量，比如标题里含有title，百分比里含有%，就像下面这样当度量值名称含有不同的字符时进行不同的格式化显示

![https://img-blog.csdnimg.cn/img_convert/876161aa7fe6ea44396be4f1dfa266c5.png](https://img-blog.csdnimg.cn/img_convert/876161aa7fe6ea44396be4f1dfa266c5.png)

效果如下，无论是日期还是百分比都有按我们期望的进行格式化显示

![https://img-blog.csdnimg.cn/img_convert/1ffa96e0aeff32730a39c43e40f7ca1b.png](https://img-blog.csdnimg.cn/img_convert/1ffa96e0aeff32730a39c43e40f7ca1b.png)

## 自动单位

首先我们先来尝试使用FORMAT函数进行格式化

![https://img-blog.csdnimg.cn/img_convert/09dfe210704370e2210e5a2c101bccbf.png](https://img-blog.csdnimg.cn/img_convert/09dfe210704370e2210e5a2c101bccbf.png)

度量值并没有被格式化

![https://img-blog.csdnimg.cn/img_convert/86cb4236c3944f3f43fa7e3dac7a2c46.png](https://img-blog.csdnimg.cn/img_convert/86cb4236c3944f3f43fa7e3dac7a2c46.png)

其实要解决这个问题也比较简单，只需要在表达式前加两个双引号就好了，

![https://img-blog.csdnimg.cn/img_convert/734f8334d1c5f0dae6eedf1718faab8c.png](https://img-blog.csdnimg.cn/img_convert/734f8334d1c5f0dae6eedf1718faab8c.png)

前面也有介绍到UNICHAR，所以使用UNICHAR(34)代替""""也行。

![https://img-blog.csdnimg.cn/img_convert/69a3d345966c2506995c22ee8e6d138a.png](https://img-blog.csdnimg.cn/img_convert/69a3d345966c2506995c22ee8e6d138a.png)

解决了这个问题，我们就可以来给数值自动加单位，毕竟PowerBI中自动单位并不算好用，比如我们想实现万，PowerBI的格式字符串中只有千分位符，我们是没办法通过使用千分位符来切换成万的，但是使用格式表达式前加""""方式我们可以实现万的切换

![https://img-blog.csdnimg.cn/img_convert/c12cb9dfaa75fff4eae83a0f7ce246f3.png](https://img-blog.csdnimg.cn/img_convert/c12cb9dfaa75fff4eae83a0f7ce246f3.png)

效果如下，如果不加""""，结果就是错误的，有兴趣的可以再尝试下

![https://img-blog.csdnimg.cn/img_convert/2be58ec6f8b98945d4457e0a8b09aebb.png](https://img-blog.csdnimg.cn/img_convert/2be58ec6f8b98945d4457e0a8b09aebb.png)

## 同时显示值和百分比

从上面的示例可以总结出如果要在格式表达式中使用FORMAT，则前面需要加""""来避免错误，掌握这一点，我们就可以来做些更特别的，比如同时显示值和百分比。就像下面这样

![https://img-blog.csdnimg.cn/img_convert/8073be0d1aa8e15130e1b50822817b5c.png](https://img-blog.csdnimg.cn/img_convert/8073be0d1aa8e15130e1b50822817b5c.png)

这里在显示值时分了三部分

-   原始的度量值
-   同比增加或下降的符号
-   同比的值

![https://img-blog.csdnimg.cn/img_convert/d9984ce23a28c4cabb4f99f669702630.png](https://img-blog.csdnimg.cn/img_convert/d9984ce23a28c4cabb4f99f669702630.png)

借助于这种方法，我们也可以显示成这样

![https://img-blog.csdnimg.cn/img_convert/a508845df0aae5eadf53793ac9757401.png](https://img-blog.csdnimg.cn/img_convert/a508845df0aae5eadf53793ac9757401.png)

## 总结

使用计算组中的格式表达式我们能够实现一些特殊的场景，但是目前也并不是PowerBI中的所有视觉对象都支持，虽然微软早上2020年时就宣布要修复该问题，毕竟Bug微，至今还未得到修复。但是，这并不影响我们去学习并探索计算组中格式表达式的更多用途。

## 可能感兴趣

[PowerBI自动切换中英文单位](http://mp.weixin.qq.com/s?__biz=MzAxNjc4ODE0MQ==&mid=2649124903&idx=1&sn=f9a50f7e653ca069bd29a51e34be5e5c&chksm=83fdafe5b48a26f37102fca68d75dc1d772ae461946bcb21adc698d2b18b5ba76a05e93f2b8d&scene=21#wechat_redirect)

[使用计算组在工具提示中解释度量值](http://mp.weixin.qq.com/s?__biz=MzAxNjc4ODE0MQ==&mid=2649125888&idx=1&sn=928a4c481a2cc0f1af65c5363328977d&chksm=83fdabc2b48a22d41a7d9b658cf56ca46254c994d6cad2b2d428a163111ffe37fd7aea265f04&scene=21#wechat_redirect)